{"version":3,"sources":["../scripts.babel/background.js"],"names":[],"mappings":"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","file":"background.js","sourcesContent":["'use strict';\n\nvar exceptionUrls = [];\nvar isExceptionUrl = false;\n\n// ParseURL Utility Functionality\nfunction parseURL(url) {\n  var a =  document.createElement('a');\n  a.href = url;\n  return {\n    source: url,\n    protocol: a.protocol.replace(':',''),\n    host: a.hostname\n    };\n}\n\nfunction loadExceptions(exceptionUrls) {\n  var req = new XMLHttpRequest();\n  req.open('GET', NETKI_API_HOST + '/api/browsersupport/exceptions');\n  req.onreadystatechange = function() {\n\n    var urls;\n\n    if(req.readyState === 4) {\n      var data = JSON.parse(req.responseText);\n      if(data.success) {\n        chrome.storage.sync.set({\n          exceptionUrls: data.exception_urls\n        }, function() {});\n        exceptionUrls = data.exception_urls;\n        urls = data.exception_urls;\n      } else {\n        chrome.storage.sync.get({\n          exceptionUrls: []\n        }, function(items) {\n          exceptionUrls = items.exceptionUrls;\n          urls = items.exceptionUrls;\n        });\n      }\n      getIsSiteException(urls);\n    }\n  };\n  req.send();\n}\n\n// Wallet Name Lookup Handling Functions\nfunction getIsSiteException(exceptionUrls) {\n  chrome.tabs.query(\n    {'active': true, 'lastFocusedWindow': true},\n    function(tabs) {\n      isExceptionUrl = false;\n      if(tabs != null && tabs.length > 0 && tabs[0].url !== \"\") {\n        exceptionUrls.forEach(function(value) {\n          var urlObj = parseURL(tabs[0].url);\n          if(urlObj.host.indexOf(value) != -1) {\n            isExceptionUrl = true;\n          }\n        });\n      }\n    }\n  );\n}\n\nfunction resolveWalletName(walletName, currency, tab, editable) {\n  var req = new XMLHttpRequest();\n  req.open('GET', NETKI_PUBAPI_HOST + '/api/wallet_lookup/' + walletName + '/' + currency);\n  req.onreadystatechange = function() {\n    if (req.readyState === 4) {\n      var data = JSON.parse(req.responseText);\n\n      if(data.success) {\n        if(editable) {\n\n          chrome.tabs.sendMessage(tab.id, {\n            args: {\n              type: 'walletNameResolution',\n              walletName: walletName,\n              walletAddress: data.wallet_address\n            }\n          });\n        }\n      } else {\n        chrome.tabs.sendMessage(tab.id, {\n          args: {\n            type: 'walletNameNotFound',\n            walletName: walletName\n          }\n        });\n      }\n    }\n  };\n  req.send();\n}\n\nfunction getWalletCurrencies(walletName, tab, editable) {\n  var req = new XMLHttpRequest();\n  req.open('GET', NETKI_PUBAPI_HOST + '/api/wallet_lookup/' + walletName + '/available_currencies');\n  req.onreadystatechange = function() {\n    if(req.readyState === 4) {\n      var data = JSON.parse(req.responseText);\n\n      if(data.success) {\n\n        if(data.available_currencies.length > 1) {\n          chrome.tabs.sendMessage(tab.id, {\n            args: {\n              type: 'availableCurrencies',\n              walletName: walletName,\n              currencies: data.available_currencies\n            }\n          });\n        } else {\n          resolveWalletName(walletName, data.available_currencies[0], tab, editable);\n        }\n\n      } else {\n        chrome.tabs.sendMessage(tab.id, {\n          args: {\n            type: 'walletNameNotFound',\n            walletName: walletName\n          }\n        });\n      }\n    }\n  };\n  req.send();\n}\n\nfunction lookupClickHandler(info, tab) {\n  if(isWalletName(info.selectionText)) {\n    getWalletCurrencies(info.selectionText, tab, info.editable);\n  } else {\n    chrome.tabs.sendMessage(tab.id, {\n      args: {\n        type: 'walletNameNotFound',\n        walletName: info.selectionText\n      }\n    });\n  }\n}\n\n// Setup Context Menu\nchrome.runtime.onInstalled.addListener(function() {\n  var title = 'Lookup Wallet Name';\n  var context = 'selection';\n  chrome.contextMenus.create({'title': title, 'contexts':[context],\n    'id': 'context' + context});\n});\n\n// Setup onload handler to set the exception flag for the URL\nchrome.webNavigation.onCompleted.addListener(function(details) {\n  loadExceptions();\n});\n\n// Setup Chrome Message Passing\nchrome.runtime.onMessage.addListener(function (message, sender, sendResponse) {\n  switch (message.type) {\n    case 'walletNameLookup':\n      return resolveWalletName(message.wn, message.currency, sender.tab, true);\n    case 'getWalletCurrencies':\n      if (!isExceptionUrl && isWalletName(message.lookupValue)) {\n        return getWalletCurrencies(message.lookupValue, sender.tab, true);\n      }\n      return;\n  }\n});\n\nchrome.contextMenus.onClicked.addListener(lookupClickHandler);\n"]}